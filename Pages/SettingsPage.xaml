<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="AmongUsModManager.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:AmongUsModManager.Models"
    xmlns:local="using:AmongUsModManager.Pages"
    x:DataType="local:SettingsPage"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <InfoBar x:Name="UnsavedChangesBar"
                 Grid.Row="0"
                 Title="未保存の変更があります"
                 Message="ページを離れる前に設定を保存しますか？"
                 IsOpen="False"
                 Severity="Warning">
            <InfoBar.ActionButton>
                <Button Content="保存して移動" Click="SaveAndExit_Click" Style="{StaticResource AccentButtonStyle}"/>
            </InfoBar.ActionButton>
        </InfoBar>

        <ScrollViewer Grid.Row="1" Margin="24,0,24,0">
            <StackPanel Spacing="32" MaxWidth="800" HorizontalAlignment="Left">
                <TextBlock Text="設定" FontSize="28" FontWeight="SemiBold" Margin="0,24,0,12"/>

                <StackPanel Spacing="8">
                    <TextBlock Text="登録済みのフォルダ" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <ListView x:Name="VanillaPathListView" ItemsSource="{x:Bind VanillaPaths}" SelectionMode="None" BorderThickness="1" BorderBrush="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="4">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="models:VanillaPathInfo">
                                <Grid ColumnDefinitions="Auto, *, Auto" Padding="12" ColumnSpacing="12">
                                    <TextBox Text="{x:Bind Name, Mode=TwoWay}" Width="150" VerticalAlignment="Center"/>
                                    <TextBlock Grid.Column="1" Text="{x:Bind Path}" Foreground="Gray" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                    <Button Grid.Column="2" Content="削除" Click="RemovePath_Click" VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>

                <MenuFlyoutSeparator/>

                <StackPanel Spacing="12">
                    <TextBlock Text="Among Us の自動検出" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <TextBlock Text="指定がない場合はすべてのドライブをスキャンします" Style="{StaticResource CaptionTextBlockStyle}" Foreground="Gray"/>

                    <Grid ColumnDefinitions="*, Auto" Width="500" HorizontalAlignment="Left">
                        <TextBox x:Name="ScanTargetTextBox" PlaceholderText="スキャンするドライブまたはフォルダを選択" IsReadOnly="True" VerticalAlignment="Center"/>
                        <Button Grid.Column="1" Content="場所を選択" Click="SelectScanTarget_Click" Margin="8,0,0,0"/>
                    </Grid>

                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <Button Content="スキャン開始" Click="ScanDrives_Click" Style="{StaticResource AccentButtonStyle}"/>
                        <Button Content="パスをクリア" Click="ClearScanTarget_Click" />
                        <Button x:Name="AddAllButton" Content="すべて追加" Click="AddAllDetected_Click" IsEnabled="False"/>
                    </StackPanel>

                    <ListView x:Name="DetectedPathListView" ItemsSource="{x:Bind DetectedPaths}" MaxHeight="200" BorderThickness="1" BorderBrush="{ThemeResource SystemControlBackgroundChromeMediumLowBrush}" CornerRadius="4">
                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Grid ColumnDefinitions="*, Auto" Padding="8">
                                    <TextBlock Text="{x:Bind}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                    <Button Grid.Column="1" Content="追加" Click="AddDetectedSingle_Click" Tag="{x:Bind}"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>

                <MenuFlyoutSeparator/>

                <StackPanel Spacing="8">
                    <TextBlock Text="Modインストール先フォルダ" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                    <Grid ColumnDefinitions="*, Auto" Width="600" HorizontalAlignment="Left">
                        <TextBox x:Name="ModDataPathTextBox" IsReadOnly="True" Grid.Column="0" VerticalAlignment="Center"/>
                        <Button Content="変更" Click="ChangeModPath_Click" Grid.Column="1" Margin="8,0,0,0"/>
                    </Grid>
                </StackPanel>

                <Button x:Name="SaveButton" Content="設定を保存" Click="SaveButton_Click" Style="{StaticResource AccentButtonStyle}" Width="150" Margin="0,20,0,40"/>
                <TextBlock x:Name="StatusMessage" Margin="0,-30,0,0"/>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
